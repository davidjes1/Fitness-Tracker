<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Training Tracker</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Archivo:wght@400;600;700&family=JetBrains+Mono:wght@400;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #0a0e12;
            --bg-secondary: #151a21;
            --bg-tertiary: #1f2832;
            --accent-primary: #00ff88;
            --accent-secondary: #00ccff;
            --accent-danger: #ff3366;
            --text-primary: #e8eef3;
            --text-secondary: #8a95a3;
            --border: #2a3441;
            --shadow: rgba(0, 255, 136, 0.1);
        }
        
        body {
            font-family: 'Archivo', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        .header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            padding: 1.5rem;
            border-bottom: 2px solid var(--accent-primary);
            box-shadow: 0 4px 20px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            animation: slideDown 0.4s ease-out;
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }
        
        .phase-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--accent-primary);
            border-radius: 20px;
            font-size: 0.85rem;
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent-primary);
        }
        
        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            padding: 1rem;
            background: var(--bg-secondary);
            overflow-x: auto;
            border-bottom: 1px solid var(--border);
        }
        
        .nav-tab {
            padding: 0.75rem 1.25rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .nav-tab:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }
        
        .nav-tab.active {
            background: var(--accent-primary);
            color: var(--bg-primary);
            border-color: var(--accent-primary);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .view {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        
        .view.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.2s ease;
        }
        
        .card:hover {
            border-color: var(--accent-primary);
            box-shadow: 0 4px 20px var(--shadow);
        }
        
        .card-header {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--accent-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            background: var(--accent-primary);
            color: var(--bg-primary);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Archivo', sans-serif;
            font-size: 1rem;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        
        .btn-danger {
            background: var(--accent-danger);
            color: white;
        }
        
        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }
        
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Archivo', sans-serif;
            font-size: 1rem;
            transition: all 0.2s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1);
        }
        
        .form-input::placeholder {
            color: var(--text-secondary);
            opacity: 0.6;
        }
        
        select.form-input {
            cursor: pointer;
        }
        
        textarea.form-input {
            resize: vertical;
            min-height: 80px;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .exercise-entry {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            margin-bottom: 0.75rem;
        }
        
        .exercise-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .set-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            align-items: end;
        }
        
        .set-number {
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent-primary);
            font-weight: 600;
            padding: 0.75rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            background: var(--bg-tertiary);
            padding: 1.25rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            text-align: center;
            transition: all 0.2s ease;
        }
        
        .stat-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-primary);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 0.5rem;
        }
        
        .workout-log-entry {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .workout-log-entry:hover {
            border-color: var(--accent-primary);
            transform: translateX(4px);
        }
        
        .workout-log-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.5rem;
        }
        
        .workout-type {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--bg-primary);
            border-radius: 20px;
            font-size: 0.8rem;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .workout-type.strength {
            border: 1px solid var(--accent-primary);
            color: var(--accent-primary);
        }
        
        .workout-type.cardio {
            border: 1px solid var(--accent-secondary);
            color: var(--accent-secondary);
        }
        
        .workout-date {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .workout-summary {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 18, 0.95);
            z-index: 1000;
            overflow-y: auto;
            animation: fadeIn 0.2s ease-in;
        }
        
        .modal.active {
            display: flex;
            align-items: start;
            justify-content: center;
            padding: 2rem 1rem;
        }
        
        .modal-content {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-primary);
            border-radius: 12px;
            padding: 2rem;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
        }
        
        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            line-height: 1;
            transition: all 0.2s ease;
        }
        
        .close-btn:hover {
            color: var(--accent-primary);
            transform: rotate(90deg);
        }
        
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid;
        }
        
        .alert-danger {
            background: rgba(255, 51, 102, 0.1);
            border-color: var(--accent-danger);
            color: var(--accent-danger);
        }
        
        .alert-success {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .btn-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .workout-detail-section {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .workout-detail-section h4 {
            color: var(--accent-primary);
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }
        
        .exercise-detail {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }
        
        .exercise-detail:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .exercise-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .sets-table {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
            
            .set-row {
                grid-template-columns: 1fr 1fr auto;
            }
            
            .modal-content {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>âš¡ Training Tracker</h1>
        <span class="phase-badge" id="currentPhase">Phase 1: Foundation</span>
    </div>
    
    <div class="nav-tabs">
        <div class="nav-tab active" data-view="log">Log Workout</div>
        <div class="nav-tab" data-view="history">History</div>
        <div class="nav-tab" data-view="progress">Progress</div>
        <div class="nav-tab" data-view="stats">Stats</div>
    </div>
    
    <div class="content">
        <!-- Log Workout View -->
        <div class="view active" id="log">
            <div class="card">
                <div class="card-header">
                    <span>New Workout</span>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Workout Type</label>
                    <select class="form-input" id="workoutType">
                        <option value="strength">Strength Training</option>
                        <option value="cardio">Cardio/Tri Maintenance</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="date" class="form-input" id="workoutDate">
                </div>
                
                <div id="strengthFields">
                    <div class="form-group">
                        <label class="form-label">Workout Template</label>
                        <select class="form-input" id="workoutTemplate">
                            <option value="">Custom Workout</option>
                            <option value="workoutA">Workout A (Squat/Bench/Row)</option>
                            <option value="workoutB">Workout B (Deadlift/Press/Pull)</option>
                        </select>
                    </div>
                    
                    <div id="exercisesContainer"></div>
                    
                    <button class="btn btn-secondary" id="addExerciseBtn">+ Add Exercise</button>
                </div>
                
                <div id="cardioFields" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Activity</label>
                        <select class="form-input" id="cardioActivity">
                            <option value="run">Run</option>
                            <option value="bike">Bike</option>
                            <option value="swim">Swim</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Duration (minutes)</label>
                        <input type="number" class="form-input" id="cardioDuration" placeholder="30">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Distance (optional)</label>
                        <input type="text" class="form-input" id="cardioDistance" placeholder="5k, 10mi, 1000m">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Avg Heart Rate (optional)</label>
                        <input type="number" class="form-input" id="cardioHR" placeholder="145">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-input" id="workoutNotes" placeholder="How did you feel? Any pain/discomfort? Energy levels?"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Recovery Score (1-10)</label>
                    <input type="number" class="form-input" id="recoveryScore" min="1" max="10" placeholder="7">
                </div>
                
                <button class="btn" id="saveWorkoutBtn">Save Workout</button>
            </div>
        </div>
        
        <!-- History View -->
        <div class="view" id="history">
            <div class="card">
                <div class="card-header">
                    <span>Workout History</span>
                </div>
                <div id="historyContainer"></div>
            </div>
        </div>
        
        <!-- Progress View -->
        <div class="view" id="progress">
            <div class="card">
                <div class="card-header">
                    <span>Progress Tracking</span>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Current Weight (lbs)</label>
                    <input type="number" step="0.1" class="form-input" id="weightEntry" placeholder="185.5">
                </div>
                
                <button class="btn btn-secondary" id="addWeightBtn">Log Weight</button>
                
                <div id="weightHistory" style="margin-top: 2rem;"></div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <span>Lift Progress</span>
                </div>
                <div id="liftProgressContainer"></div>
            </div>
        </div>
        
        <!-- Stats View -->
        <div class="view" id="stats">
            <div class="stats-grid" id="statsGrid"></div>
            
            <div class="card">
                <div class="card-header">
                    <span>Weekly Summary</span>
                </div>
                <div id="weeklySummary"></div>
            </div>
        </div>
    </div>
    
    <!-- Workout Detail Modal -->
    <div class="modal" id="workoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Workout Details</h2>
                <button class="close-btn" id="closeModalBtn">&times;</button>
            </div>
            <div id="modalBody"></div>
            <div class="btn-group" style="margin-top: 1.5rem;">
                <button class="btn btn-danger btn-small" id="deleteWorkoutBtn">Delete Workout</button>
            </div>
        </div>
    </div>

    <script>
        // Storage wrapper using window.storage
        const Storage = {
            async get(key) {
                try {
                    const result = await window.storage.get(key);
                    return result ? JSON.parse(result.value) : null;
                } catch (error) {
                    console.log(`Key ${key} not found`);
                    return null;
                }
            },
            
            async set(key, value) {
                try {
                    await window.storage.set(key, JSON.stringify(value));
                    return true;
                } catch (error) {
                    console.error('Storage error:', error);
                    return false;
                }
            },
            
            async list(prefix) {
                try {
                    const result = await window.storage.list(prefix);
                    return result ? result.keys : [];
                } catch (error) {
                    console.error('Storage error:', error);
                    return [];
                }
            },
            
            async delete(key) {
                try {
                    await window.storage.delete(key);
                    return true;
                } catch (error) {
                    console.error('Storage error:', error);
                    return false;
                }
            }
        };

        // App State
        let workouts = [];
        let weights = [];
        let exerciseCounter = 0;
        let currentWorkoutId = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await loadData();
            setupEventListeners();
            setTodayDate();
            renderStats();
            renderHistory();
            renderProgress();
        });

        async function loadData() {
            workouts = await Storage.get('workouts') || [];
            weights = await Storage.get('weights') || [];
        }

        async function saveData() {
            await Storage.set('workouts', workouts);
            await Storage.set('weights', weights);
        }

        function setTodayDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('workoutDate').value = today;
        }

        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', () => switchView(tab.dataset.view));
            });

            // Workout type toggle
            document.getElementById('workoutType').addEventListener('change', (e) => {
                const isStrength = e.target.value === 'strength';
                document.getElementById('strengthFields').style.display = isStrength ? 'block' : 'none';
                document.getElementById('cardioFields').style.display = isStrength ? 'none' : 'block';
            });

            // Template selection
            document.getElementById('workoutTemplate').addEventListener('change', (e) => {
                if (e.target.value) {
                    loadTemplate(e.target.value);
                }
            });

            // Add exercise
            document.getElementById('addExerciseBtn').addEventListener('click', addExercise);

            // Save workout
            document.getElementById('saveWorkoutBtn').addEventListener('click', saveWorkout);

            // Add weight
            document.getElementById('addWeightBtn').addEventListener('click', addWeight);

            // Modal close
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);
            document.getElementById('deleteWorkoutBtn').addEventListener('click', deleteCurrentWorkout);
        }

        function switchView(viewName) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            
            document.querySelector(`[data-view="${viewName}"]`).classList.add('active');
            document.getElementById(viewName).classList.add('active');

            if (viewName === 'stats') renderStats();
            if (viewName === 'history') renderHistory();
            if (viewName === 'progress') renderProgress();
        }

        function addExercise(name = '', sets = []) {
            const container = document.getElementById('exercisesContainer');
            const exerciseId = exerciseCounter++;
            
            const exerciseDiv = document.createElement('div');
            exerciseDiv.className = 'exercise-entry';
            exerciseDiv.dataset.exerciseId = exerciseId;
            
            exerciseDiv.innerHTML = `
                <div class="exercise-entry-header">
                    <input type="text" class="form-input" placeholder="Exercise name (e.g., Barbell Squat)" value="${name}" data-field="name">
                    <button class="btn btn-danger btn-small" onclick="removeExercise(${exerciseId})">Remove</button>
                </div>
                <div class="sets-container" data-exercise-id="${exerciseId}">
                    ${sets.length > 0 ? sets.map((s, i) => createSetRow(i + 1, s)).join('') : createSetRow(1)}
                </div>
                <button class="btn btn-secondary btn-small" onclick="addSet(${exerciseId})">+ Add Set</button>
            `;
            
            container.appendChild(exerciseDiv);
        }

        function createSetRow(setNum, set = {}) {
            return `
                <div class="set-row">
                    <div class="set-number">Set ${setNum}</div>
                    <div class="form-group" style="margin: 0;">
                        <input type="number" class="form-input" placeholder="Reps" value="${set.reps || ''}" data-field="reps">
                    </div>
                    <div class="form-group" style="margin: 0;">
                        <input type="number" class="form-input" placeholder="Weight" value="${set.weight || ''}" data-field="weight">
                    </div>
                    <button class="btn btn-danger btn-small" onclick="removeSet(this)">Ã—</button>
                </div>
            `;
        }

        function addSet(exerciseId) {
            const container = document.querySelector(`.sets-container[data-exercise-id="${exerciseId}"]`);
            const setNum = container.querySelectorAll('.set-row').length + 1;
            container.insertAdjacentHTML('beforeend', createSetRow(setNum));
        }

        function removeSet(btn) {
            btn.closest('.set-row').remove();
        }

        function removeExercise(exerciseId) {
            document.querySelector(`[data-exercise-id="${exerciseId}"]`).closest('.exercise-entry').remove();
        }

        function loadTemplate(templateName) {
            const templates = {
                workoutA: {
                    exercises: [
                        { name: 'Barbell Back Squat', sets: [{reps: 5, weight: ''}, {reps: 5, weight: ''}, {reps: 5, weight: ''}] },
                        { name: 'Barbell Bench Press', sets: [{reps: 5, weight: ''}, {reps: 5, weight: ''}, {reps: 5, weight: ''}] },
                        { name: 'Barbell Row', sets: [{reps: 5, weight: ''}, {reps: 5, weight: ''}, {reps: 5, weight: ''}] }
                    ]
                },
                workoutB: {
                    exercises: [
                        { name: 'Barbell Deadlift', sets: [{reps: 5, weight: ''}, {reps: 5, weight: ''}, {reps: 5, weight: ''}] },
                        { name: 'Overhead Press', sets: [{reps: 5, weight: ''}, {reps: 5, weight: ''}, {reps: 5, weight: ''}] },
                        { name: 'Pull-ups/Lat Pulldown', sets: [{reps: 8, weight: ''}, {reps: 8, weight: ''}, {reps: 8, weight: ''}] }
                    ]
                }
            };

            const template = templates[templateName];
            if (template) {
                document.getElementById('exercisesContainer').innerHTML = '';
                exerciseCounter = 0;
                template.exercises.forEach(ex => addExercise(ex.name, ex.sets));
            }
        }

        async function saveWorkout() {
            const workoutType = document.getElementById('workoutType').value;
            const date = document.getElementById('workoutDate').value;
            const notes = document.getElementById('workoutNotes').value;
            const recovery = document.getElementById('recoveryScore').value;

            if (!date) {
                alert('Please select a date');
                return;
            }

            const workout = {
                id: Date.now(),
                type: workoutType,
                date: date,
                notes: notes,
                recovery: recovery ? parseInt(recovery) : null,
                timestamp: new Date().toISOString()
            };

            if (workoutType === 'strength') {
                const exercises = [];
                document.querySelectorAll('.exercise-entry').forEach(entry => {
                    const name = entry.querySelector('[data-field="name"]').value;
                    if (!name) return;

                    const sets = [];
                    entry.querySelectorAll('.set-row').forEach(row => {
                        const reps = row.querySelector('[data-field="reps"]').value;
                        const weight = row.querySelector('[data-field="weight"]').value;
                        if (reps && weight) {
                            sets.push({ reps: parseInt(reps), weight: parseFloat(weight) });
                        }
                    });

                    if (sets.length > 0) {
                        exercises.push({ name, sets });
                    }
                });

                if (exercises.length === 0) {
                    alert('Please add at least one exercise with sets');
                    return;
                }

                workout.exercises = exercises;
            } else {
                const activity = document.getElementById('cardioActivity').value;
                const duration = document.getElementById('cardioDuration').value;
                const distance = document.getElementById('cardioDistance').value;
                const hr = document.getElementById('cardioHR').value;

                if (!duration) {
                    alert('Please enter workout duration');
                    return;
                }

                workout.cardio = {
                    activity,
                    duration: parseInt(duration),
                    distance: distance || null,
                    avgHR: hr ? parseInt(hr) : null
                };
            }

            workouts.unshift(workout);
            await saveData();

            // Reset form
            document.getElementById('workoutNotes').value = '';
            document.getElementById('recoveryScore').value = '';
            document.getElementById('exercisesContainer').innerHTML = '';
            document.getElementById('cardioDuration').value = '';
            document.getElementById('cardioDistance').value = '';
            document.getElementById('cardioHR').value = '';
            exerciseCounter = 0;

            alert('Workout saved successfully!');
            renderStats();
        }

        async function addWeight() {
            const weight = document.getElementById('weightEntry').value;
            if (!weight) {
                alert('Please enter your weight');
                return;
            }

            weights.unshift({
                weight: parseFloat(weight),
                date: new Date().toISOString().split('T')[0],
                timestamp: new Date().toISOString()
            });

            await saveData();
            document.getElementById('weightEntry').value = '';
            renderProgress();
            alert('Weight logged!');
        }

        function renderHistory() {
            const container = document.getElementById('historyContainer');
            
            if (workouts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ’ª</div>
                        <p>No workouts logged yet. Start tracking your progress!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = workouts.map(workout => {
                const summary = workout.type === 'strength' 
                    ? `${workout.exercises.length} exercises â€¢ ${workout.exercises.reduce((acc, ex) => acc + ex.sets.length, 0)} total sets`
                    : `${workout.cardio.activity} â€¢ ${workout.cardio.duration} min${workout.cardio.distance ? ' â€¢ ' + workout.cardio.distance : ''}`;

                return `
                    <div class="workout-log-entry" onclick="showWorkoutDetail(${workout.id})">
                        <div class="workout-log-header">
                            <span class="workout-type ${workout.type}">${workout.type.toUpperCase()}</span>
                            <span class="workout-date">${formatDate(workout.date)}</span>
                        </div>
                        <div class="workout-summary">${summary}</div>
                        ${workout.recovery ? `<div class="workout-summary">Recovery: ${workout.recovery}/10</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function showWorkoutDetail(workoutId) {
            const workout = workouts.find(w => w.id === workoutId);
            if (!workout) return;

            currentWorkoutId = workoutId;
            const modal = document.getElementById('workoutModal');
            const modalBody = document.getElementById('modalBody');

            let content = `
                <div class="workout-detail-section">
                    <h4>Date: ${formatDate(workout.date)}</h4>
                    ${workout.recovery ? `<p>Recovery Score: ${workout.recovery}/10</p>` : ''}
                </div>
            `;

            if (workout.type === 'strength') {
                content += '<div class="workout-detail-section"><h4>Exercises</h4>';
                workout.exercises.forEach(ex => {
                    content += `
                        <div class="exercise-detail">
                            <div class="exercise-name">${ex.name}</div>
                            <div class="sets-table">
                                ${ex.sets.map((set, i) => `Set ${i + 1}: ${set.reps} reps @ ${set.weight} lbs`).join('<br>')}
                            </div>
                        </div>
                    `;
                });
                content += '</div>';
            } else {
                content += `
                    <div class="workout-detail-section">
                        <h4>Cardio Details</h4>
                        <p>Activity: ${workout.cardio.activity}</p>
                        <p>Duration: ${workout.cardio.duration} minutes</p>
                        ${workout.cardio.distance ? `<p>Distance: ${workout.cardio.distance}</p>` : ''}
                        ${workout.cardio.avgHR ? `<p>Avg HR: ${workout.cardio.avgHR} bpm</p>` : ''}
                    </div>
                `;
            }

            if (workout.notes) {
                content += `
                    <div class="workout-detail-section">
                        <h4>Notes</h4>
                        <p>${workout.notes}</p>
                    </div>
                `;
            }

            modalBody.innerHTML = content;
            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('workoutModal').classList.remove('active');
            currentWorkoutId = null;
        }

        async function deleteCurrentWorkout() {
            if (!currentWorkoutId) return;
            
            if (!confirm('Are you sure you want to delete this workout?')) return;

            workouts = workouts.filter(w => w.id !== currentWorkoutId);
            await saveData();
            closeModal();
            renderHistory();
            renderStats();
            alert('Workout deleted');
        }

        function renderStats() {
            const statsGrid = document.getElementById('statsGrid');
            const weeklySummary = document.getElementById('weeklySummary');

            // Calculate stats
            const totalWorkouts = workouts.length;
            const strengthWorkouts = workouts.filter(w => w.type === 'strength').length;
            const cardioWorkouts = workouts.filter(w => w.type === 'cardio').length;
            
            const last7Days = workouts.filter(w => {
                const workoutDate = new Date(w.date);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                return workoutDate >= weekAgo;
            });

            const avgRecovery = workouts.filter(w => w.recovery).length > 0
                ? (workouts.filter(w => w.recovery).reduce((acc, w) => acc + w.recovery, 0) / workouts.filter(w => w.recovery).length).toFixed(1)
                : 'N/A';

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${totalWorkouts}</div>
                    <div class="stat-label">Total Workouts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${strengthWorkouts}</div>
                    <div class="stat-label">Strength Sessions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${cardioWorkouts}</div>
                    <div class="stat-label">Cardio Sessions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${last7Days.length}</div>
                    <div class="stat-label">Last 7 Days</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${avgRecovery}</div>
                    <div class="stat-label">Avg Recovery</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${weights.length > 0 ? weights[0].weight : 'N/A'}</div>
                    <div class="stat-label">Current Weight</div>
                </div>
            `;

            // Weekly summary
            if (last7Days.length > 0) {
                const strengthCount = last7Days.filter(w => w.type === 'strength').length;
                const cardioCount = last7Days.filter(w => w.type === 'cardio').length;
                
                weeklySummary.innerHTML = `
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">Last 7 days activity:</p>
                    <p>âœ“ ${strengthCount} strength session${strengthCount !== 1 ? 's' : ''}</p>
                    <p>âœ“ ${cardioCount} cardio session${cardioCount !== 1 ? 's' : ''}</p>
                    ${strengthCount >= 3 ? '<p style="color: var(--accent-primary); margin-top: 1rem;">ðŸŽ¯ 3x/week minimum achieved!</p>' : ''}
                `;
            } else {
                weeklySummary.innerHTML = '<p style="color: var(--text-secondary);">No workouts in the last 7 days.</p>';
            }
        }

        function renderProgress() {
            const weightHistory = document.getElementById('weightHistory');
            const liftProgress = document.getElementById('liftProgressContainer');

            // Weight history
            if (weights.length > 0) {
                const recentWeights = weights.slice(0, 10);
                weightHistory.innerHTML = `
                    <h4 style="color: var(--accent-primary); margin-bottom: 1rem;">Recent Weigh-Ins</h4>
                    ${recentWeights.map(w => `
                        <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 0.5rem;">
                            <span>${formatDate(w.date)}</span>
                            <span style="font-family: 'JetBrains Mono', monospace; color: var(--accent-primary);">${w.weight} lbs</span>
                        </div>
                    `).join('')}
                `;
            } else {
                weightHistory.innerHTML = '<p style="color: var(--text-secondary);">No weight entries yet.</p>';
            }

            // Lift progress (PR tracking)
            const lifts = {};
            workouts.filter(w => w.type === 'strength').forEach(workout => {
                workout.exercises.forEach(ex => {
                    if (!lifts[ex.name]) lifts[ex.name] = [];
                    ex.sets.forEach(set => {
                        lifts[ex.name].push({ weight: set.weight, reps: set.reps, date: workout.date });
                    });
                });
            });

            if (Object.keys(lifts).length > 0) {
                liftProgress.innerHTML = Object.keys(lifts).slice(0, 6).map(liftName => {
                    const maxWeight = Math.max(...lifts[liftName].map(s => s.weight));
                    const maxSet = lifts[liftName].find(s => s.weight === maxWeight);
                    return `
                        <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">${liftName}</div>
                            <div style="font-family: 'JetBrains Mono', monospace; color: var(--accent-primary);">
                                PR: ${maxWeight} lbs Ã— ${maxSet.reps} reps
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 0.25rem;">
                                ${formatDate(maxSet.date)}
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                liftProgress.innerHTML = '<p style="color: var(--text-secondary);">Start logging strength workouts to track PRs!</p>';
            }
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }
    </script>
</body>
</html>